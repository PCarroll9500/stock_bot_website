<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AAPL — Live Price</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg:#0b1020; --card:#121832; --text:#e9ecf1; --muted:#9aa3b2; --up:#6ae2a0; --down:#ff6b6b; }
  *{box-sizing:border-box}
  body{margin:0;min-height:100svh;display:grid;place-items:center;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .card{background:var(--card);padding:24px 28px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);min-width:280px;text-align:center}
  .ticker{font-size:1rem;color:var(--muted);letter-spacing:.15em}
  .price{font-size:2.25rem;font-weight:800;margin:.35rem 0}
  .change{font-size:1.05rem}
  .up{color:var(--up)} .down{color:var(--down)}
  .time{margin-top:.6rem;color:var(--muted);font-size:.9rem}
  .err{color:var(--down)}
  button{margin-top:12px;border:1px solid #2a355f;background:transparent;color:#cfe3ff;border-radius:10px;padding:.5rem .8rem;cursor:pointer}
</style>
</head>
<body>
  <div class="card">
    <div class="ticker">NASDAQ: AAPL</div>
    <div id="price" class="price">—</div>
    <div id="change" class="change">Loading…</div>
    <div id="time" class="time"></div>
    <button id="refreshBtn">Refresh</button>
  </div>

<script>
const PROXY = 'https://api.allorigins.win/raw?url=';
const YAHOO = 'https://query1.finance.yahoo.com/v8/finance/chart/AAPL?interval=1m&range=1d';

// Helper: fetch with timeout
async function fetchWithTimeout(url, ms = 5000) {
  const ctl = new AbortController();
  const t = setTimeout(() => ctl.abort(), ms);
  try {
    const r = await fetch(url, { signal: ctl.signal, cache: 'no-store' });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return await r.json();
  } finally {
    clearTimeout(t);
  }
}

function fmt(n, digits=2) {
  return Number(n).toLocaleString(undefined, { minimumFractionDigits: digits, maximumFractionDigits: digits });
}

async function load() {
  const priceEl = document.getElementById('price');
  const changeEl = document.getElementById('change');
  const timeEl = document.getElementById('time');

  changeEl.textContent = 'Loading…';
  changeEl.className = 'change';

  try {
    // Use a free CORS proxy to reach Yahoo from a static page
    const url = PROXY + encodeURIComponent(YAHOO + `&v=${Date.now()}`);
    const data = await fetchWithTimeout(url, 7000);

    const res = data?.chart?.result?.[0];
    if (!res) throw new Error('Malformed data');

    // Current price (last close/last trade in the 1m series)
    const closes = res.indicators?.quote?.[0]?.close || [];
    // take last non-null close
    let curr = null;
    for (let i = closes.length - 1; i >= 0; i--) { if (closes[i] != null) { curr = closes[i]; break; } }
    if (curr == null) throw new Error('No price');

    const prevClose = res.meta?.chartPreviousClose;
    if (typeof prevClose !== 'number') throw new Error('No previous close');

    const change = curr - prevClose;
    const pct = (change / prevClose) * 100;
    const up = change >= 0;

    priceEl.textContent = `$${fmt(curr)}`;
    priceEl.className = 'price ' + (up ? 'up' : 'down');

    const arrow = up ? '▲' : '▼';
    changeEl.textContent = `${arrow} ${fmt(change)} (${fmt(pct)}%) today`;
    changeEl.className = 'change ' + (up ? 'up' : 'down');

    const ts = res.timestamp?.[res.timestamp.length - 1];
    const when = ts ? new Date(ts * 1000) : new Date();
    timeEl.textContent = `Updated ${when.toLocaleString()}`;
  } catch (e) {
    priceEl.textContent = 'Error';
    changeEl.textContent = (e && e.message) ? e.message : 'Failed to fetch';
    changeEl.className = 'change err';
    console.error(e);
  }
}

document.getElementById('refreshBtn').addEventListener('click', load);
load();
setInterval(load, 60_000); // refresh every 60s
</script>
</body>
</html>
